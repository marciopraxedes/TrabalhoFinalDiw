<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Cadastros</title>
    <link rel="shortcut icon" href="favicon.ico">
    <link rel="stylesheet" href="css/bootstrap.css">

    <script>        
            function init() {
                initDBEngine();
                openDB();
    
                // Adiciona Listerners
                $("#btnInsert").click(function () {
                    if (!$('#form-veiculo')[0].checkValidity()) {
                        displayMessage("Preencha o formulário corretamente.");
                        return;
                    }
                    let campoNome = $("#inputNome").val();
                    let campoVersao = $("#inputVersao").val();
                    let campoMontadora = $("#inputMontadora").val();
                    let campoAno = $("#inputAno").val();
                    let campoCombustivel = $("#inputCombustivel").val();
                    let campoPotencia = $("#inputPotencia").val();
                    let campoFipe = $("#inputFipe").val();

                    let veiculo = { nome: campoNome, versao: campoVersao, montatora: campoMontadora, ano: campoAno, combustivel: campoCombustivel, potencia: campoPotencia, fipe: campoFipe };
    
                    insertVeiculo(veiculo);
                    $("#form-veiculo")[0].reset();
                    setTimeout(exibeVeiculo, 200);
                });
    
                // Intercepta o click do botão Alterar
                $("#btnUpdate").click(function () {
                    let campoId = $("#inputId").val();
                    if (campoId == "") {
                        displayMessage("Informe o ID do contato a ser alterado e a alteração desejada.");
                        return;
                    }
                    let campoNome = $("#inputNome").val();
                    let campoVersao = $("#inputVersao").val();
                    let campoMontadora = $("#inputMontadora").val();
                    let campoAno = $("#inputAno").val();
                    let campoCombustivel = $("#inputCombustivel").val();
                    let campoPotencia = $("#inputPotencia").val();
                    let campoFipe = $("#inputFipe").val();

                    let veiculo = { nome: campoNome, versao: campoVersao, montatora: campoMontadora, ano: campoAno, combustivel: campoCombustivel, potencia: campoPotencia, fipe: campoFipe };
    
                    updateVeiculo(campoId, veiculo);
                    $("#form-veiculo")[0].reset();
                    setTimeout(exibeVeiculo, 200);
                });
    
                // Intercepta o click do botão Excluir
                $("#btnDelete").click(function () {
                    let campoId = $("#inputId").val();
                    if (campoId == "") {
                        displayMessage("Informe o ID do contato a ser excluído.");
                        return;
                    }
                    deleteVeiculo(campoId);
                    $("#form-veiculo")[0].reset();
                    setTimeout(exibeVeiculo, 200);
                });
    
                // Intercepta o click do botão Listar Contatos
                $("#btnList").click(function () {
                    exibeVeiculo();
                });
    
                // Intercepta o click do botão Listar Contatos
                $("#btnClear").click(function () {
                    $("#form-veiculo")[0].reset();
                });
    
                // Oculta a mensagem de aviso após alguns segundos
                $('#msg').bind("DOMSubtreeModified", function () {
                    window.setTimeout(function () {
                        $(".alert").fadeTo(500, 0).slideUp(500, function () {
                            $(this).remove();
                        });
                    }, 5000);
                });
    
                $("#grid-veiculo").on("click", "tr", function (e) {
                    let linhaVeiculo = this;
                    $("#inputId").val(linhaVeiculo.childNodes[0].firstChild.nodeValue);
                    $("#inputNome").val(linhaVeiculo.childNodes[1].firstChild.nodeValue);
                    $("#inputVersao").val(linhaVeiculo.childNodes[2].firstChild.nodeValue);
                    $("#inputMontadora").val(linhaVeiculo.childNodes[3].firstChild.nodeValue);
                    $("#inputAno").val(linhaVeiculo.childNodes[4].firstChild.nodeValue);
                    $("#inputCombustivel").val(linhaVeiculo.childNodes[5].firstChild.nodeValue);
                    $("#inputPotencia").val(linhaVeiculo.childNodes[6].firstChild.nodeValue);
                    $("#inputFipe").val(linhaVeiculo.childNodes[7].firstChild.nodeValue);
                });
    
                setTimeout(exibeVeiculo, 200);
            }
    
            function exibeVeiculo() {
                $("#table-veiculo").html("");
                getAllVeiculo(function (veiculo) {
                    $("#table-veiculo").append("<tr><td scope=\"row\">" + veiculo.id + "</th><td>" + veiculo.nome
                        + "</td><td>" + veiculo.telefone + "</td><td>" + veiculo.email + "</td></tr>");
                });
            }
        
        </script>
    
</head>
<body onload="init()">
    <div class="container">
            <div class="jumbotron">
                    <h1 class="display-4"><b>Sistema de cadastro de veículos </b></h1>
                    <p class="lead">Márcio Júnio Praxedes</p>
                    <hr class="my-4">
                    <p>Selecione uma das opções abaixos</p>
                        <nav class="nav nav-pills flex-column flex-sm-row">
                            <a class="flex-sm-fill text-sm-center nav-link" href="index.html">Home</a>
                            <a class="flex-sm-fill text-sm-center nav-link active" href="cadastro.html">Cadastro</a>
                            <a class="flex-sm-fill text-sm-center nav-link" href="ficha.html">Ficha</a>
                            <a class="flex-sm-fill text-sm-center nav-link" href="registros.html">Registros</a>
                        </nav>
            </div>  
            
            <form id="form-veiculo">
                    <div class="form-group row">
                        <div class="col-sm-4">
                            <label for="inputId">Id</label>
                            <input type="text" class="form-control" id="inputId" placeholder="ID">
                            <small>Informe apenas para alterar/excluir</small>
                        </div>
                        <div class="col-sm-8">
                            <label for="inputNome">Nome (*)</label>
                            <input type="text" class="form-control" id="inputNome" required placeholder="Informe o nome do contato">
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-sm-5">
                            <label for="inputTelefone">Telefone (*)</label>
                            <input type="text" class="form-control" id="inputTelefone" required placeholder="Telefone">
                        </div>
                        <div class="col-sm-7">
                            <label for="inputEmail">E-mail (*)</label>
                            <input type="email" class="form-control" id="inputEmail" required placeholder="Informe o e-mail">
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-sm-4">
                            <small>(*) Campos obrigatórios</small>
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-sm-12">
                            <input type="button" class="btn btn-success" id="btnInsert" value="Inserir">
                            <input type="button" class="btn btn-warning" id="btnUpdate" value="Alterar">
                            <input type="button" class="btn btn-danger" id="btnDelete" value="Excluir">
                            <input type="button" class="btn btn-secondary" id="btnList" value="Listar Contatos">
                            <input type="button" class="btn btn-secondary" id="btnClear" value="Limpar Form">
                        </div>
                    </div>
                </form>
    </div>   

    <script type="text/javascript" src="js/db.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
</body>
</html>